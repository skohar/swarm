- name: Update system package
  sudo: yes
  apt:
    upgrade: safe
    state: present
    update_cache: yes
- name: Configure resolvconf
  sudo: yes
  lineinfile:
    dest: /etc/resolvconf/resolv.conf.d/base
    line: 'options single-request-reopen'
  register: modify_resolvconf
- name: Update resolvconf
  when: modify_resolvconf | changed
  sudo: yes
  command: resolvconf -u
- name: Basic installation (build-essential curl git)
  sudo: yes
  apt:
    name: "{{item}}"
  with_items:
    - build-essential
    - curl
    - git
# Installing NodeJS
- name: Verify node installation
  shell: type node
  register: verify_node
  failed_when: verify_node.rc not in [0, 1, 127]
  changed_when: verify_node.rc in [1, 127]
- name: Download node package
  when: verify_node | changed
  sudo: yes
  shell: curl -sL https://deb.nodesource.com/setup_{{node_version}} | bash -
- name: Install NodeJS
  sudo: yes
  apt:
    name: nodejs
# Installing Docker
- include: docker.yml
- name: Update motd
  sudo: yes
  copy:
    src: motd.j2
    dest: /etc/update-motd.d/99-environment
    mode: 0755
- name: Set environment file
  sudo: yes
  copy:
    src: environment-{{env}}.j2
    dest: /etc/update-motd.d/environment
    mode: 0644
