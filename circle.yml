machine:
  python:
    version: 2.7.10
  environment:
    PATH: "${HOME}/bin:${PATH}"
    REGION: us-east-1
    SUBNET_ID: subnet-ee4c93d3
    SECURITY_GROUP_ID: sg-ce6bb7a8
    KEY_NAME: code-check-whale
    COUNT: 2
    INSTANCE_TYPE: t2.medium
    DEV_COUNT: 1
    DEV_INSTANCE_TYPE: t2.small
checkout:
  post:
    - git submodule sync
    - git submodule update --init
dependencies:
  cache_directories:
    - ~/bin
  pre:
    - mkdir -p ~/bin
    - ./cache_packer.sh
test:
  override:
    - source ami_name.sh && PACKER_LOG=1 packer validate -var "AMI_NAME=$(name)" packer.json
deployment:
  production:
    branch: deployment/production
    commands:
      - ./deploy.sh "whale"
  staging:
    branch: master
    commands:
      - ./deploy.sh "whale-dev"
  develop:
    branch: bgd_terraform
    commands:
      - PACKER_LOG=1 ./deploy.sh "whale-dev"
