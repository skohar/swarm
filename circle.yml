machine:
  python:
    version: 2.7.10
  environment:
    PATH: "${HOME}/bin:${PATH}"
    REGION: us-east-1
    AWS_DEFAULT_REGION: us-east-1
    SUBNET_ID: subnet-ee4c93d3
    SECURITY_GROUP_ID: sg-ce6bb7a8
    KEY_NAME: code-check-whale
    COUNT: 2
    INSTANCE_TYPE: t2.medium
    DEV_COUNT: 1
    DEV_INSTANCE_TYPE: t2.small
    PACKER_LOG: 1
checkout:
  post:
    - git submodule sync
    - git submodule update --init
dependencies:
  cache_directories:
    - ~/bin
  pre:
    - mkdir -p ~/bin
    - ./install_softwares.sh
test:
  override:
    - source generate_ami_name.sh && packer validate -var "AMI_NAME=$(generate_ami_name)" packer.json
deployment:
  production:
    branch: deployment/production
    commands:
      - ./deploy-all.sh "whale":
          timeout: 2400
  staging:
    branch: master
    commands:
      - ./deploy-all.sh "whale-dev":
          timeout: 2400

  develop:
    branch: develop
    commands:
      - ./deploy-all.sh "whale-dev":
          timeout: 2400
